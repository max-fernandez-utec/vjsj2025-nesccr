pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
-- shmup
-- tisj 2025

function _init()
	j=make_player()
	e=make_enemy()
	
	stars.ini()
end

function _update()
	-- acciones jugador
	j.dx=0
	j.dy=0
	if (btn(⬅️)) j.dx=-1
	if (btn(➡️)) j.dx+=1
	if (btn(⬆️)) j.dy=-1
	if (btn(⬇️)) j.dy+=1
	
	-- disparo jug
	if (btnp(🅾️)) shoot(j.x,j.y-8,0,-3)	
	
	-- upd de capa de fondo
	stars.upd()
	
	for e in all(entities) do
		e.upd()
	end
end

function _draw()
	cls()
	
	-- capa fondo
	stars.drw()
	
	-- entidades
	for e in all(entities) do
		e.drw()
	end
	
	-- interfaz de usuario
	map()
	
	-- debug
	print(#entities,0,9,8)
end

-->8
-- entidades
entities={}

function make_entity()
	local e={
		x=0,y=0,dx=0,dy=0,
		cnt=0,
		s=1,sprs={1},
	}
	
	e.upd=function()
		e.x+=e.dx
		e.y+=e.dy
	
		e.s=1 + e.cnt % #e.sprs
		e.cnt+=1
	end
	
	e.drw=function()
		spr(e.sprs[e.s],e.x,e.y)
	end
	
	add(entities,e)
	
	return e
end

function make_player()
	local j=make_entity()
	j.x=64
	j.y=64
	j.sprs={17,18,19,20}
	
	local aux=j.upd
	j.upd=function()
		if (j.x<-3) j.x=-3
		if (j.y<0) j.y=0
		if (j.x>124) j.x=124
		if (j.y>124) j.y=124
		aux()
	end
	
	j.drw=function()
		-- cuerpo de la nave
		local s=1
	
		if (j.dx>0) s=3
		if (j.dx<0) s=2
		
		spr(s,j.x,j.y)
		
		-- fuego
		spr(j.sprs[j.s],j.x,j.y+8)
	end
	
	return j
end

function make_enemy()
	local e=make_entity()
	
	e.x=64
	e.y=12
	e.sprs={32,33,34,35}
	
	return e
end

-- particulas
shoots={}

function make_shoot()
	local s=make_entity()
	s.sprs={21}
	
	local aux=s.upd
	s.upd=function()
		aux()
		
		if 
			s.y<-10 or 
			s.x<-10 or 
			s.y>130 or 
			s.x>130 then
			-- destruir el disparo
			del(entities,s)
		end
	end
	
	return s
end

function shoot(x,y,dx,dy)
	local s=make_shoot()
	s.x=x
	s.y=y
	s.dx=dx
	s.dy=dy
	
	sfx(0)
	
	return s
end

-->8
-- capa de fondo


stars={
	stars={},
	
	ini=function()
		for i=1,40 do
			local c=rnd({5,6,7})
			local ts={0,0,1}
			local vs={.2,.7,1}
			
			add(stars.stars, {
				x=flr(rnd(128)),
				y=flr(rnd(128)),
				c=c,
				t=ts[c-4],
				v=vs[c-4]
			})
		end
	end,
	
	upd=function()
		for s in all(stars.stars) do
			s.y+=s.v
			
			if (s.y>130) s.y=0
		end
	end,
	
	drw=function()
		for s in all(stars.stars) do
			circfill(s.x,s.y,s.t,s.c)
		end
	end
}
__gfx__
00000000000e80000000e80000e80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000e88800000e880000e88000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070000e7c800007c880000e87c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700000ecc80000cc880000e8cc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000008112000011220000881100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007000e8e8280008e280000e88200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000e88e82880e8e28800e8e8280000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000008992000089920000899200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000aa000000aa000000aa000000aa000000cc00000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000aa00000a99a0000a99a0000a99a0000c77c0000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000a99a0000a99a0000a99a0000c77c0000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000aa00000a99a0000a99a0000c77c0000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000aa00000a99a0000c77c0000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000aa00000c77c0000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000c77c0000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000cc00000000000000000000000000000000000000000000000000000000000000000000000000000000000
000cc000000cc000000cc000000cc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00c66c0000c66c0000c66c0000c66c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0cb6b6c00cb6b6c00cb6b6c00cb6b6c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0cc66cc00cc66cc00cc66cc00cc66cc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0ccc6cc00ccc6cc00ccc6cc00ccc6cc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555555555555555555555555555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0ee22220022ee22002222ee002222220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001d1d0000d1d100001d1d0000d1d100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dd66666666666666666666dd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66dddddddddddddddddddd6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6d00000000000000000000d600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
d0000000000000000000000d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
dd6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666dd
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd66
6d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d6
d00000000000000000000000000000000000000000000000000000000000000cc00000000000000000000000000000000000000000000000000000000000000d
00000000000000000000000000000000000000000000000000000000000000c77c00000000000000000000000000000000000000000000000000000000000000
80000000000000000000000000000000000000000000000000000000000000c77c00000000000000000000000000000000000000000000000000000000000000
80000000000000000000000000000000000000000000000000000000000000c77c00000000000000000000000000000000000000000000000000000000000000
88800000000000000000000000000000000000000000000000000000000000c77c00000000000000000000000000000000000000000000000000000000000000
80800000000000000000000000000000000000000000000000000000000000c77c0cc00000000000000000000000000000000000000000000000000000000000
88800000000000000000000000000000000000000000000000000000000000c77cc66c0000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000cccb6b6c000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000cc66cc000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000ccc6cc000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000005555555500000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000022ee22000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000cc00000d1d10000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000c77c000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000c77c000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000c77c000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000c77c000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000c77c000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000c77c000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000cc0000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000cc00000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000c77c0000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000c77c0000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000c77c0000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000c77c0000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000c77c0000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000c77c0000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000cc00000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000e800000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000e8880000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000e7c80000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000ecc80000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000081120000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000e8e828000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000e88e828800000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000089920000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000aa00000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000a99a0000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000a99a0000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000aa00000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

__map__
3031313131313131313131313131313200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
0001000004150111501b15022150271502c1502f1503215035150371503615035150331502f1502a150241501f1501a15014150121500e1500c15009150071500515003150031500215002150011500015000150
00010000125601b55020550235502655027550295502a5502a5502a5502a55029550285502655024550215501f5501c5501a5501955017550155501455013550145501555016550185501b5501f5502155025550
